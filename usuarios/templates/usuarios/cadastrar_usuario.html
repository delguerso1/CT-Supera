{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h2>Cadastrar Novo Usu√°rio</h2>

    <form method="post" class="mt-3">
        {% csrf_token %}
        <div>
            {{ form.cpf.label_tag }} {{ form.cpf }}
            {% if form.cpf.errors %}<div class="text-danger">{{ form.cpf.errors }}</div>{% endif %}
        </div>
        <div>
            {{ form.nome.label_tag }} {{ form.nome }}
            {% if form.nome.errors %}<div class="text-danger">{{ form.nome.errors }}</div>{% endif %}
        </div>
        <div>
            {{ form.tipo.label_tag }} {{ form.tipo }}
            {% if form.tipo.errors %}<div class="text-danger">{{ form.tipo.errors }}</div>{% endif %}
        </div>
        <div>
            {{ form.telefone.label_tag }} {{ form.telefone }}
            {% if form.telefone.errors %}<div class="text-danger">{{ form.telefone.errors }}</div>{% endif %}
        </div>
        <div>
            {{ form.endereco.label_tag }} {{ form.endereco }}
            {% if form.endereco.errors %}<div class="text-danger">{{ form.endereco.errors }}</div>{% endif %}
        </div>
        <div>
            {{ form.data_nascimento.label_tag }} {{ form.data_nascimento }}
            {% if form.data_nascimento.errors %}<div class="text-danger">{{ form.data_nascimento.errors }}</div>{% endif %}
        </div>
        <div>
            {{ form.password.label_tag }} {{ form.password }}
            {% if form.password.errors %}<div class="text-danger">{{ form.password.errors }}</div>{% endif %}
        </div>
        <div id="div_id_telefone_responsavel">
            {{ form.telefone_responsavel.label_tag }} {{ form.telefone_responsavel }}
            {% if form.telefone_responsavel.errors %}<div class="text-danger">{{ form.telefone_responsavel.errors }}</div>{% endif %}
        </div>
        <div id="div_id_telefone_emergencia">
            {{ form.telefone_emergencia.label_tag }} {{ form.telefone_emergencia }}
            {% if form.telefone_emergencia.errors %}<div class="text-danger">{{ form.telefone_emergencia.errors }}</div>{% endif %}
        </div>
        <button type="submit" class="btn btn-success">Cadastrar</button>
        <a href="{% url 'usuarios:lista_usuarios' %}" class="btn btn-secondary">Voltar para lista</a>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    function atualizarCampos() {
        const tipo = document.getElementById('id_tipo').value;
        const dataNascInput = document.getElementById('id_data_nascimento');
        const campoResponsavel = document.getElementById('div_id_telefone_responsavel');
        const campoEmergencia = document.getElementById('div_id_telefone_emergencia');
        campoResponsavel.style.display = 'none';
        campoEmergencia.style.display = 'none';

        if (tipo === 'aluno' && dataNascInput.value) {
            const nasc = new Date(dataNascInput.value);
            const hoje = new Date();
            let idade = hoje.getFullYear() - nasc.getFullYear();
            const m = hoje.getMonth() - nasc.getMonth();
            if (m < 0 || (m === 0 && hoje.getDate() < nasc.getDate())) {
                idade--;
            }
            if (idade < 18) {
                campoResponsavel.style.display = '';
            } else {
                campoEmergencia.style.display = '';
            }
        }
        if (tipo === 'professor') {
            campoResponsavel.style.display = 'none';
            campoEmergencia.style.display = 'none';
        }
    }
    document.getElementById('id_tipo').addEventListener('change', atualizarCampos);
    document.getElementById('id_data_nascimento').addEventListener('change', atualizarCampos);
    atualizarCampos();
});
</script>

{% endblock %}